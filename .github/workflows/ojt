<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OJT Report System with Login</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; margin:0; padding:0 15px 40px; color: #333; }
header { background: #004080; color: white; padding: 20px; text-align: center; border-radius: 0 0 10px 10px; }
h1 { margin:0; font-weight:700; font-size:1.8rem; }
.container { max-width: 900px; margin: 0 auto; }
.card { background:white; border-radius:10px; padding:20px; margin-bottom:25px; box-shadow:0 2px 8px rgb(0 0 0 / 0.1); }
input[type="text"], input[type="password"], input[type="file"], select, textarea { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; font-size:1rem; }
textarea { min-height:70px; resize: vertical; }
button { padding:10px 20px; border:none; border-radius:6px; font-weight:600; cursor:pointer; font-size:1rem; margin-right:5px; }
button.submit-btn { background:#28a745; color:white; }
button.submit-btn:hover { background:#19692c; }
button.role-btn { background:#0073e6; color:white; }
button.role-btn.active, button.role-btn:hover { background:#004080; }
button.approve-btn { background:#28a745; color:white; }
button.approve-btn:hover { background:#19692c; }
button.feedback-btn { background:#dc3545; color:white; }
button.feedback-btn:hover { background:#a32227; }
button.delete-btn { background:#6c757d; color:white; }
button.delete-btn:hover { background:#495057; }
.report-card { border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; background:#fafafa; }
.report-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; margin-bottom:12px; }
.report-header strong { font-size:1.1rem; color:#004080; }
.status { font-weight:700; padding:4px 10px; border-radius:15px; font-size:0.9rem; color:white; min-width:90px; text-align:center; }
.status.Pending { background:#f0ad4e; }
.status.Approved { background:#28a745; }
.status.NeedsRevision { background:#dc3545; }
.report-tabs { margin-bottom:15px; text-align:center; }
.report-tabs .tab-btn { background:#0073e6; color:white; font-weight:600; padding:8px 20px; border-radius:5px; margin:0 5px; cursor:pointer; }
.report-tabs .tab-btn.active, .report-tabs .tab-btn:hover { background:#004080; }
a.download-link { text-decoration:none; color:#0073e6; font-weight:600; }
a.download-link:hover { text-decoration:underline; }
#loginSection {
  max-width: 400px;
  margin: 40px auto;
  padding: 20px;
}

#loginSection input[type="text"],
#loginSection input[type="password"],
#loginSection button {
  width: 100%;
  display: block;
  margin-bottom: 15px;
  box-sizing: border-box;
}
#loginSection button {
  padding: 12px;
  font-weight: 700;
}
#loginSection p {
  text-align: center;
  margin-top: 10px;
}

#logoutBtn { background:#dc3545; color:white; float:right; padding:8px 16px; margin-bottom:15px; }
#logoutBtn:hover { background:#a32227; }
@media (max-width:600px){ .report-header{flex-direction:column; align-items:flex-start;} .status{min-width:auto;} }
</style>
</head>
<body>

<header>
<h1>OJT Report Submission & Monitoring System</h1>
</header>

<div class="container">

  <!-- Login Section -->
  <section id="loginSection" class="card">
    <h2>Login</h2>
    <label>Username</label>
    <input type="text" id="loginUsername" placeholder="Enter username">
    <label>Password</label>
    <input type="password" id="loginPassword" placeholder="Enter password">
    <button class="submit-btn" id="loginBtn">Login</button>
    <p><small>Student: student/123 | Instructor: instructor/123</small></p>
  </section>

  <!-- Main System -->
  <div id="mainSystem" style="display:none;">

    <button id="logoutBtn">Logout</button>

    <div id="studentSection" class="card" style="display:none;">
      <h2>Submit Your OJT Report</h2>
      <label for="studentName">Student Name</label>
      <input type="text" id="studentName" placeholder="Enter your full name">
      <label for="reportType">Report Type</label>
      <select id="reportType">
        <option value="Narrative">Narrative Report</option>
        <option value="Weekly">Weekly Report</option>
      </select>
      <label for="reportFile">Upload Report File</label>
      <input type="file" id="reportFile" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt">
      <button class="submit-btn" id="submitReportBtn">Submit Report</button>
    </div>

    <div id="instructorSection" class="card" style="display:none;">
      <h2>Review Submitted Reports</h2>
      <div class="report-tabs">
        <button class="tab-btn active" onclick="filterReports('Narrative')">Narrative <span id="countNarrative">(0)</span></button>
        <button class="tab-btn" onclick="filterReports('Weekly')">Weekly <span id="countWeekly">(0)</span></button>
      </div>
      <div id="submittedReportsContainer"></div>
    </div>

  </div>

</div>

<script>
const STORAGE_KEY = 'ojtReports';
let reports = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let currentTab = 'Narrative';

const loginSection = document.getElementById('loginSection');
const mainSystem = document.getElementById('mainSystem');
const studentSection = document.getElementById('studentSection');
const instructorSection = document.getElementById('instructorSection');

const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');

loginBtn.addEventListener('click', () => {
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value.trim();
  if(username==='student' && password==='123'){
    loginSection.style.display='none';
    mainSystem.style.display='block';
    studentSection.style.display='block';
    instructorSection.style.display='none';
    document.getElementById('studentName').value = username;
  } else if(username==='instructor' && password==='123'){
    loginSection.style.display='none';
    mainSystem.style.display='block';
    studentSection.style.display='none';
    instructorSection.style.display='block';
    displayReports();
  } else { alert('Invalid credentials'); }
});

logoutBtn.addEventListener('click', () => {
  loginSection.style.display='block';
  mainSystem.style.display='none';
  document.getElementById('loginUsername').value='';
  document.getElementById('loginPassword').value='';
});

// File to Base64
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.readAsDataURL(file);
    reader.onload=()=>resolve(reader.result);
    reader.onerror=err=>reject(err);
  });
}

// Student submit report
document.getElementById('submitReportBtn').addEventListener('click', async () => {
  const name = document.getElementById('studentName').value.trim();
  const type = document.getElementById('reportType').value;
  const file = document.getElementById('reportFile').files[0];
  if(!name||!file){alert('Please fill all fields.'); return;}
  const fileData = await fileToBase64(file);
  const newReport = {id:Date.now(), studentName:name, fileName:file.name, fileData, status:'Pending', feedback:'', type};
  reports.push(newReport);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(reports));
  alert('Report submitted successfully!');
  document.getElementById('reportFile').value='';
});

// Filter reports for tabs
function filterReports(type){
  currentTab=type;
  document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.remove('active'));
  event.target.classList.add('active');
  displayReports();
}

// Display reports
function displayReports(){
  const container=document.getElementById('submittedReportsContainer');
  container.innerHTML='';
  updateTabCounts();
  const filtered = reports.filter(r=>r.type===currentTab);
  if(filtered.length===0){container.innerHTML='<p>No reports submitted yet for this type.</p>'; return;}
  filtered.forEach(report=>{
    const div=document.createElement('div');
    div.className='report-card';
    div.innerHTML=`
      <div class="report-header">
        <strong>Student:</strong> ${report.studentName}
        <a class="download-link" href="${report.fileData}" download="${report.fileName}">&#128190; Download</a>
        <span class="status ${report.status.replace(/\s/g,'')}">${report.status}</span>
      </div>
      <div><strong>Feedback:</strong> ${report.feedback||'<em>No feedback yet</em>'}</div>
      <div class="feedback-area">
        <textarea id="feedback_${report.id}" placeholder="Write feedback here..."></textarea>
        <br>
        <button class="approve-btn" onclick="approveReport(${report.id})">Approve</button>
        <button class="feedback-btn" onclick="sendFeedback(${report.id})">Send Feedback</button>
        <button class="delete-btn" onclick="deleteReport(${report.id})">Delete</button>
      </div>
    `;
    container.appendChild(div);
  });
}

// Status actions
function approveReport(id){ const r=reports.find(r=>r.id===id); if(r){r.status='Approved'; localStorage.setItem(STORAGE_KEY, JSON.stringify(reports)); displayReports(); alert(`${r.studentName} approved.`); } }
function sendFeedback(id){ const feedback=document.getElementById(`feedback_${id}`).value.trim(); if(!feedback){alert('Enter feedback.'); return;} const r=reports.find(r=>r.id===id); if(r){r.feedback=feedback; r.status='Needs Revision'; localStorage.setItem(STORAGE_KEY, JSON.stringify(reports)); displayReports(); alert(`Feedback sent to ${r.studentName}.`);} }
function deleteReport(id){ if(!confirm('Delete this report?')) return; reports=reports.filter(r=>r.id!==id); localStorage.setItem(STORAGE_KEY, JSON.stringify(reports)); displayReports(); }

// Update tab counts
function updateTabCounts(){
  const narrativeCount = reports.filter(r=>r.type==='Narrative').length;
  const weeklyCount = reports.filter(r=>r.type==='Weekly').length;
  document.getElementById('countNarrative').innerText=`(${narrativeCount})`;
  document.getElementById('countWeekly').innerText=`(${weeklyCount})`;
}

// Make functions global
window.approveReport=approveReport; window.sendFeedback=sendFeedback; window.deleteReport=deleteReport;
</script>

</body>
</html>
